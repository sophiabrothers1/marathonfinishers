---
title: "What Makes a Marathon Runner Fast? Key Predictors of Finishing Times"
subtitle: "Age, gender, nationality, and race experience are the strongest factors influencing performance."
author: 
  - Sophia Brothers
thanks: "Code and data are available at: [https://github.com/sophiabrothers1/marathonfinishers](https://github.com/sophiabrothers1/marathonfinishers)."
date: today
date-format: long
abstract: "This paper develops a linear model for marathon finishing times using factors such as age, gender, country, pace, and race experience. The analysis identifies key trends, including that younger runners, male participants, Kenyan athletes, and individuals with moderate NYRR race experience achieve the fastest time. These findings provide insights into the characteristics that influence marathon performance, contributing to a deeper understanding of endurance running. 
This research provides valuable insights for athletes, coaches, and sports organizations, helping them design better training strategies and improve marathon performance."
format: pdf
toc: true
toc-depth: 3
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

# Install Packages if not downloaded:
required_packages <- c(
  "tidyverse", "here", "arrow", "ggplot2", "kableExtra", "modelsummary"
)
for (p in required_packages) {
  if (!require(p, character.only = TRUE)) {
    install.packages(p, character.only = TRUE)
  }
}

# load libraries
library(tidyverse)
library(dplyr)
library(here)
library(arrow)
library(ggplot2)
library(kableExtra)
library(modelsummary)

# load data
cleaned_data <- read_parquet(here::here("data/analysis_data/marathon_results_cleaned.parquet"))
```

# Introduction

Marathon running has grown exponentially in popularity in recent years, attracting individuals from diverse backgrounds to participate in races of varying distances and difficulty levels [@hillier]. Despite the increasing number of participants, predicting marathon performance remains a challenging task due to the multitude of factors influencing finishing times. These factors include age, gender, experience, and training, all of which contribute to the overall race outcome. However, while existing studies have explored marathon times, there remains a gap in understanding the quantitative relationships between these variables and how they influence performance.

This paper aims to fill this gap by developing a linear regression model to predict marathon finishing times based on variables such as age, gender, country, and previous race experience. The primary estimand of this study is the prediction of a runner’s overall marathon finishing time, in seconds, as a function of their age, gender, country, and race count. By estimating this relationship, the model quantifies the effect of these variables on marathon performance and identifies the key factors that influence race outcomes.

The analysis revealed that age and gender are significant predictors of marathon finishing times, with older runners generally taking longer to finish, and male runners achieving faster times. These findings contribute to the broader understanding of marathon performance and can assist in setting realistic expectations for future participants based on their individual characteristics.

The paper is structured as follows: @sec-data discusses the data and data cleaning process, followed by the analysis of key variables and relationships in @sec-model. @sec-results then presents the results from the linear regression model, followed by a discussion of the implications of these findings in @sec-discussion. @sec-discussion also concludes with suggestions for future research and practical applications of the model.

# Data {#sec-data}

## Overview

This study utilizes NYC marathon finishers' data that was sourced through the Data is Plural newsletter [@nycmarathon]. This data provides detailed information on select runner demographics, race results, and other performance-related metrics. The dataset includes variables such as runner identity, demographic information (age, gender, city, country), and race performance data (finishing times, pace, rankings). These variables together form a comprehensive profile of marathon participants, enabling the exploration of how different factors contribute to marathon outcomes.

We used R [@citeR] for data cleaning and analysis, leveraging packages such as **`tidyverse`** for data manipulation and visualization [@tidyverse], **`here`** for file path management [@here], **`lubridate`** for date handling [@lubridate], **`arrow`** for data storage and processing [@arrow], **`testthat`** for unit testing [@testthat], **`readr`** for reading structured data [@readr], **`dplyr`** for data manipulation [@dplyr], **`stringr`** for string operations [@stringr], **`ggplot2`** for creating visualizations [@ggplot2], **`caret`** for modeling [@caret], **`kableExtra`** for creating tables [@kableExtra], and **`modelsummary`** for summarizing models and results [@modelsummary].

## Measurement

The measurement process refers to how we go from real-world phenomena—such as a runner’s time in a race, their age, or their gender—to numerical entries in a dataset. Each entry represents a distinct runner’s marathon performance and is recorded in the dataset.

**Overall Time (`overall_time`)**: This is the time it takes for a runner to complete the marathon, measured in hours, minutes, and seconds. It is recorded by the timing system used during the race, which uses a chip timer. Timing mats are located at the start, every 5K, halfway (13.1 miles), mile 20, and the finish. The data in the dataset records this time in a standardized format (HH:MM:SS), which is then converted into numerical values (seconds) for modeling purposes.

**Age (`age`)**: This is the age of the runner at the time of the marathon. It is typically self-reported at the time of registration and stored in the race’s database. The dataset uses the reported age as a direct entry for each runner.

**Gender (`gender`)**: The gender of the runner is recorded at the time of registration and stored as a categorical variable (e.g., male, female, other).

**Races Count (`races_count`)**: This variable reflects the number of marathons or races a runner has participated in. This variable is typically gathered from historical race records with New York Road Runners, the organization that hosts the NYC Marathon.

**IAAF Category (`iaaf_category`):** This is a country code that indicates the nationality of the runner, as classified by the International Association of Athletics Federations (IAAF). It is recorded during registration based on the runner’s stated nationality or residency. The data is stored as a standardized three-letter country code (e.g., USA, CAN, GBR) and serves as a categorical variable.

## Data Cleaning

The raw marathon finisher data underwent a several cleaning steps to ensure it was accurate, consistent, and ready for analysis. These steps included renaming columns for clarity, converting variables to appropriate data types, handling missing values by assigning default placeholders, and transforming time-based variables (e.g., overall time and pace) into numerical formats for modeling purposes. This resulted in the creation of two columns, `overall_time_seconds` and `pace_seconds`, which converted the overall time and pace data into seconds. The cleaned dataset was then saved as a Parquet file for efficient storage and further analysis.

## Outcome Variables

The outcome variable is **`overall_time_seconds`**. This is the primary dependent variable that the model is designed to predict. It represents the total time (in seconds) a runner takes to finish the marathon. The model aims to understand the factors that influence this time, which is a direct measure of performance in the race. @fig-timesdistribution displays the actual finish times, measured in seconds, with the majority of finishers completing the race within 3.5 hours to 4.5 hours.

```{r}
#| label: fig-timesdistribution
#| fig-cap: "Distribution of marathon finish times, highlighting the concentration around the 4-hour mark. The skew towards longer finish times reflects the diverse abilities of participants."
#| echo: false
#| eval: true
#| warning: false
#| message: false


# create histogram of finish times
ggplot(cleaned_data, aes(x = overall_time_seconds)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(
    title = "Distribution of Marathon Finish Times",
    x = "Finish Time (seconds)",
    y = "Frequency"
  ) +
  theme_minimal()
```

## Predictor Variables

The **predictor variables** (or independent variables) are the factors believed to influence the overall finishing time:

1.  **Age (`age`)**: The runner's age is a key factor influencing marathon performance. The age value is an important variable as it directly relates to the physical capabilities of the runner, with younger runners often performing better, though not always in a linear fashion. Ages 25-40 are the most popular ages represented in the NYC marathon, as depicted in @fig-agedistribution.

2.  **Gender (`gender`)**: The gender of the runner is included as a categorical variable (male/female/other). This is a key variable in the dataset because gender has been found to correlate with marathon performance, where physiological differences typically result in different average finishing times. In @fig-genderdistribution, we see that the vast majority of runners identify as either Male or Female, with a marginal amount identifying as Other. There are more Male runners than Female runners.

3.  **Races Count (`races_count`)**: This variable represents the number of races a runner has participated in, which can be an indicator of experience but is also correlated with age. It is an indirect measurement of experience, with the assumption that more experienced runners tend to perform better. @fig-racecountdistribution shows that the majority of runners were completing their first race. Interestingly, there is a minor spike at 10, likely because of NYRR's 9+1 program that guarantees entree to the marathon (the 10th race).

4.  **IAAF Category (`iaaf_category`)**: The IAAF category represents the country of the runner. In @fig-countrydistribution we see that the USA is the most represented country, which makes sense given that the race is located in New York City. Italy and France are the next most represented countries.

```{r}
#| label: fig-agedistribution
#| fig-cap: "Distribution of runners' ages, showing a wide range of participation with a peak in the 30-40 age group, a common range for competitive runners."
#| echo: false
#| eval: true
#| warning: false
#| message: false

# create histogram of finish times
ggplot(cleaned_data, aes(x = age)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(
    title = "Distribution of Age",
    x = "Age",
    y = "Frequency"
  ) +
  theme_minimal()
```

```{r}
#| label: fig-countrydistribution
#| fig-cap: "Distribution of marathon participants by country, limited to those with more than 100 runners. The United States has the highest number of participants, followed by several other countries with a smaller but significant representation."
#| echo: false
#| eval: true
#| warning: false
#| message: false


filtered_data <- cleaned_data %>%
  group_by(iaaf_category) %>%
  filter(n() > 100) %>%
  ungroup()

ggplot(filtered_data, aes(x = iaaf_category)) +
  geom_bar(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(
    title = "Distribution of Runners by Country (IAAF Category)",
    x = "Country (IAAF Category)",
    y = "Number of Runners"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Rotate x-axis labels for better readability
```

```{r}
#| label: fig-genderdistribution
#| fig-cap: "Gender distribution among marathon participants, revealing a relatively even split, with a slight predominance of male runners."
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Gender distribution plot
ggplot(cleaned_data, aes(x = gender, fill = gender)) +
  geom_bar(alpha = 0.7) +
  labs(
    title = "Gender Distribution of Runners",
    x = "Gender",
    y = "Count"
  ) +
  theme_minimal()
```

```{r}
#| label: fig-racecountdistribution
#| fig-cap: "Distribution of the number of races completed by runners, indicating that most participants are relatively inexperienced, with a smaller number of highly experienced runners."
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Adjusted binwidth and zoomed-in distribution plot
ggplot(cleaned_data, aes(x = races_count)) +
  geom_histogram(binwidth = 1, fill = "purple", color = "black", alpha = 0.7) +
  labs(
    title = "Distribution of Races Count",
    x = "Number of Races",
    y = "Frequency"
  ) +
  theme_minimal() +
  xlim(0, 50) # Set x-axis limits to zoom in on more common values
```

These predictors were selected based on both domain knowledge of marathon running and the availability of data in the dataset. The model examines how these factors collectively contribute to overall race performance, helping to provide insights into which variables most strongly influence marathon finishing times.

# Model {#sec-model}

## Model Set-Up

The goal of this analysis is to build a linear model to predict a runner’s overall marathon finishing time in seconds (`overall_time_seconds`) based on several predictor variables. The outcome variable, `overall_time_seconds`, is continuous and represents the total time in seconds taken by a runner to complete the marathon.

The linear regression model is specified as follows:

$$overall\_time\_seconds_i​=\beta_0​+\beta_1​⋅age_i​+\beta_2⋅gender_i​+\beta_3⋅race\_count_i​​+ \beta_4⋅iaaf\_category​​ + ϵ_i​$$

Where:

-   `overall_time_seconds` is the marathon finishing time in seconds for the i-th runner.

-   `age` is the runner's age at the time of the race

-   `gender` is the runner's gender (treated as a categorical variable).

-   `race_count`​ is the total number of marathons the runner has participated in prior to the race.

-   `iaaf_category`​ is the country the runner is from under IAAF standards.

-   epsilon is the error term, assumed to be normally distributed with a mean of 0 and constant variance $ϵ_i​∼N(0,\sigma^2)$

The model assumes that the predictors have a linear relationship with the response variable, i.e., the overall time is linearly related to the selected features. We are interested in estimating the coefficients $\beta_1$, $\beta_2$,...,$\beta_4$ which represent the effect of each predictor on the outcome.

## Model Justification

The linear regression model was chosen for several reasons. Firstly, a linear regression model is straightforward and easy to interpret. Each coefficient directly indicates how much the marathon finishing time changes with a one-unit increase in the corresponding predictor, assuming all other variables remain constant.

The model accommodates both continuous predictors (like age and race count) and categorical variables (such as gender and IAAF country classification). This flexibility makes it well-suited for the dataset.

Additionally, previous studies in sports science consistently show that factors like age, gender, nationality, and running experience significantly affect marathon performance [@Connick2015, @Cheuvront2005, @kenyanrunners]. Including these predictors aligns with established domain knowledge, ensuring the model is based on sound reasoning.

Models like random forests and generalized additive models (GAMs) were also explored. These can capture more complex relationships but are harder to interpret and communicate. Since interpretability is a priority for this analysis, linear regression was preferred. Alternative models may be more appropriate if predictive power is the main goal, but simplicity and transparency make linear regression the better choice for the current objectives.

## Assumptions and Limitations

The linear regression model relies on several key assumptions. First, it assumes a linear relationship between the predictors and the outcome variable, meaning that a unit change in a predictor corresponds to a consistent change in the response variable. Second, the residuals of the model must be independent to ensure that the statistical inferences drawn, such as significance tests and confidence intervals, are valid. Third, the variance of the residuals (errors) should remain constant across all levels of the predictors, an assumption known as homoscedasticity. Fourth, the errors should follow a normal distribution, which is critical for accurate hypothesis testing and confidence interval estimation. Lastly, the model assumes no perfect multicollinearity among the predictors, as highly correlated variables can obscure the individual effects of each predictor on the outcome.

Regardless of these assumptions, the model has limitations. It may not effectively capture complex or non-linear relationships between predictors and the outcome, which could lead to an oversimplified interpretation of the data. For example, the effect of age on marathon times may not be linear across all age groups, and a non-linear model might better capture this relationship. Interaction effects, where certain combinations of predictors interact to influence finishing times, are not accounted for in this model. For instance, the combined effect of experience (race count) and age might have a more significant impact on marathon performance than either variable alone. Additionally, outliers—such as unusually high or low marathon times—can disproportionately affect the results, potentially skewing the analysis.

Other external factors that may influence marathon performance, but are not included in this model, could limit its explanatory power. Environmental factors like weather conditions on race day, course difficulty (e.g., elevation changes), and runner health or injuries are not considered in this analysis, though they could significantly affect finishing times. Moreover, the model assumes that all runners have similar training levels, but differences in training intensity, diet, and sleep patterns could also impact performance. The model does not address these outstanding factors, which may limit its applicability in specific scenarios. These assumptions and limitations should be carefully considered when interpreting the model’s results and applying them to broader contexts.

## Model Validation

Model validation is an essential part of ensuring that the model generalizes well to new, unseen data. To validate the performance of the linear model, we employed the following techniques:

1.  **Out-of-Sample Testing**: The data was randomly split into training and test sets, with 80% used for training the model and 20% reserved for testing. This allows us to assess how well the model performs on data that was not used during training.

2.  **Root Mean Squared Error (RMSE)**: The RMSE was calculated on the test set to evaluate the model's predictive accuracy. In @tbl-keysummary we see that the RMSE is 3416.17. The RMSE provides an estimate of the average error between the predicted and actual values of the outcome variable, meaning that the average error between the model and actual time is ± 3416.17 seconds. A lower RMSE indicates better predictive performance.

```{r}
#| include: false
#| warning: false
#| message: false

finisher_model <- readRDS(here::here("models/finisher_model.rds"))

# Clean the data: Remove rows with missing values, convert 'overall_time' to numeric (seconds), and ensure 'gender' is a factor
marathon_data_cleaned <- cleaned_data %>%
  filter(!is.na(overall_time_seconds), !is.na(gender), !is.na(country_code)) %>%
  mutate(
    # Recode gender values to a more interpretable form
    gender = recode(gender, "M" = "Male", "W" = "Female", "X" = "Other"), # Adjust "X" as needed
    gender = as.factor(gender), # Ensure gender is a factor variable
    overall_time_seconds = as.numeric(overall_time_seconds), # Convert overall_time to seconds if it's not already
    country_code = as.factor(country_code), # Ensure country_code is a factor
    races_count = as.integer(races_count) # Ensure races_count is an integer
  )


marathon_data_cleaned$predicted_time <- predict(finisher_model, newdata = marathon_data_cleaned)
```

```{r}
#| label: tbl-keysummary
#| tbl-cap: Summary of the marathon finishing time model, which includes age, gender, and race count. The table presents the model coefficients along with their standard errors.
#| echo: false
#| eval: true
#| warning: false
#| message: false

modelsummary(finisher_model,
  output = "kableExtra",
  statistic = "std.error",
  coef_map = c(
    "(Intercept)" = "GenderMale",
    "genderFemale" = "GenderFemale",
    "genderOther" = "GenderOther",
    "age" = "Age",
    "races_count" = "Race Count"
  )
) %>%
  kable_styling(latex_options = c("striped", "scale_down"))
```

# Results {#sec-results}

These statistics indicate that, on average, participants completed the marathon in approximately 4 hours and 31 minutes and 48 seconds (271.8 minutes). The average participant age was 39.89 years, and the average pace was 10.37 minutes per mile. 55,524 people completed the New York City Marathon.

```{r}
#| label: tbl-marathon-summary
#| tbl-cap: Summary statistics of the marathon data, including the average finish time, average age, and total number of participants analyzed.
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Determine summary statistics
summary_stats <- cleaned_data %>%
  summarise(
    AverageFinishTime = mean(overall_time_seconds / 60, na.rm = TRUE),
    AverageAge = mean(age),
    AveragePace = mean(pace_seconds / 60, na.rm = TRUE),
    TotalParticipants = n()
  )

# Display summary statistics
summary_stats %>%
  kable(
    col.names = c("Average Finish Time (minutes)", "Average Age (years)", "Average Pace (minutes/mile)", "Total Participants"),
    digits = 2,
    booktabs = TRUE
  ) %>%
  kable_styling(latex_options = c("striped", "scale_down"))
```

@fig-predicted-vs-actual-age compares the predicted and actual marathon times across different age groups. The plot reveals a linear relationship between predicted and actual times, with the reference red dashed line representing perfect predictions. The data shows that older age groups tend to have higher finishing times, but the model performs consistently across age categories.

```{r}
#| label: fig-predicted-vs-actual-age
#| fig-cap: Predicted vs Actual Marathon Finishing Times by Age Group. The scatter plot shows how well the predicted finishing times compare with the actual times across different age groups, with a reference line indicating perfect predictions.
#| echo: false
#| eval: true
#| warning: false
#| message: false


# Create age groups for segmentation
marathon_data_cleaned$age_group <- cut(marathon_data_cleaned$age,
  breaks = c(18, 30, 40, 50, 60, 70, 80),
  labels = c("18-30", "31-40", "41-50", "51-60", "61-70", "71-80")
)


# Predicted vs Actual by Age Group
ggplot(marathon_data_cleaned, aes(x = overall_time_seconds / 60, y = predicted_time / 60, color = age_group)) +
  geom_point(alpha = 0.5) +
  geom_abline(slope = 1, intercept = 0, color = "red", linetype = "dashed") + # Add reference line for perfect predictions
  labs(
    title = "Predicted vs. Actual Time by Age Group",
    x = "Actual Time (minutes)",
    y = "Predicted Time (minutes)"
  ) +
  theme_minimal() +
  theme(legend.title = element_blank()) +
  facet_wrap(~age_group)
```

The distribution of predicted marathon finishing times by gender was visualized using a boxplot in @fig-predicted-time-gender. This analysis shows that the predicted times for males is lower than that for females, suggesting that the model may predict faster times for males on average. The distribution of predicted times for males tends to be slightly more spread out. The median predicted time for males is lower than that for females.

```{r}
#| label: fig-predicted-time-gender
#| fig-cap: Predicted Marathon Finishing Times by Gender. The boxplot displays the distribution of predicted marathon times for different genders, showing median values and variability in finishing times.
#| echo: false
#| eval: true
#| warning: false
#| message: false


# Predicted time by gender
ggplot(marathon_data_cleaned, aes(x = gender, y = predicted_time / 60, color = gender)) +
  geom_boxplot() +
  labs(
    title = "Predicted Time by Gender",
    x = "Gender",
    y = "Predicted Time (minutes)"
  ) +
  theme_minimal()
```

The boxplot shown in @fig-predicted-time-age demonstrates the distribution of predicted marathon times across different age groups. As expected, older participants tend to have slower predicted finishing times, with the younger two age groups (18-30 and 31-40) showing the fastest predicted times on average.

```{r}
#| label: fig-predicted-time-age
#| fig-cap: Predicted Marathon Finishing Times by Age Group. This boxplot visualizes the predicted marathon times across various age groups, showing how age influences the predicted finishing times.
#| echo: false
#| eval: true
#| warning: false
#| message: false


# Predicted time by age
ggplot(marathon_data_cleaned, aes(x = age_group, y = predicted_time / 60, color = age_group)) +
  geom_boxplot() +
  labs(
    title = "Predicted Time by Age",
    x = "Age",
    y = "Predicted Time (minutes)"
  ) +
  theme_minimal()
```

@tbl-predicted and @tbl-actual compare the actual best-performing groups with their corresponding predicted best groups across four categories: age, gender, number of races completed, and IAAF category. A category must have at least 25 entries/predictions to be considered.

1.  **Age**

    -   **Actual Best Group**: Age 28 had the fastest mean actual marathon time of 15,570.83 seconds, with a participant count of 2,042.

    -   **Predicted Best Group**: The predictive model identified Age 18 as the best-performing group, with a faster predicted mean time of 14,340.60 seconds.

2.  **Gender**

    -   The actual and predicted best groups for gender were both **Male**, with closely aligned mean times: **15,413.65 seconds** (actual) and **15,423.57 seconds** (predicted).

3.  **Races Count**

    -   **Actual Best Group**: Runners who participated in 5 NYRR races had the fastest mean actual time of 15,779.89 seconds, with a participant count of 818.

    -   **Predicted Best Group**: The model predicted runners with 10 races as the best-performing group, with a slightly slower mean time of 16,042.84 seconds.

4.  **IAAF Category**

    -   Both the actual and predicted best-performing group was KEN (Kenya), with mean times of 12,026.07 seconds (actual) and 12,079.54 seconds (predicted).

```{r}
#| label: tbl-actual
#| tbl-cap: Actual Marathon Finishing Times by Group. This table shows the best group (age, gender, race count, IAAF category) based on actual marathon times.
#| echo: false
#| eval: true
#| warning: false
#| message: false


# Generate model predictions for the filtered dataset
marathon_data_filtered <- marathon_data_cleaned %>%
  mutate(predicted_time = predict(finisher_model, newdata = marathon_data_cleaned))

# Function to calculate the best group for actual or predicted times
calculate_best_times <- function(data, group_var, time_col) {
  data %>%
    group_by({{ group_var }}) %>%
    filter(n() > 25) %>% # Only include groups with more than 25 entries
    summarise(
      best_group = as.character(first({{ group_var }})), # Convert to character for consistency
      mean_time = mean({{ time_col }}, na.rm = TRUE)
    ) %>%
    ungroup() %>%
    arrange(mean_time) %>%
    slice_head(n = 1)
}

# Calculate the best groups for actual times
best_age_actual <- calculate_best_times(marathon_data_filtered, age, overall_time_seconds) %>% mutate(category = "Age")
best_gender_actual <- calculate_best_times(marathon_data_filtered, gender, overall_time_seconds) %>% mutate(category = "Gender")
best_race_count_actual <- calculate_best_times(marathon_data_filtered, races_count, overall_time_seconds) %>% mutate(category = "Races Count")
best_iaaf_category_actual <- calculate_best_times(marathon_data_filtered, iaaf_category, overall_time_seconds) %>% mutate(category = "IAAF Category")

# Combine actual results into a single table
actual_table <- bind_rows(best_age_actual, best_gender_actual, best_race_count_actual, best_iaaf_category_actual) %>%
  select(
    category,
    best_group, mean_time
  ) %>%
  rename(
    "Category" = category,
    "Actual Best Group" = best_group,
    "Actual Mean Time (seconds)" = mean_time
  )

# Format the actual table for display
actual_table_display <- kable(actual_table, align = c("l", "l", "c")) %>%
  kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover", "condensed"))

# Display both tables individually
actual_table_display # Display Actual Times Table
```

```{r}
#| label: tbl-predicted
#| tbl-cap: Predicted Marathon Finishing Times by Group. This table shows the best group (age, gender, race count, IAAF category) based on predicted marathon times.
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Calculate the best groups for predicted times
best_age_predicted <- calculate_best_times(marathon_data_filtered, age, predicted_time) %>% mutate(category = "Age")
best_gender_predicted <- calculate_best_times(marathon_data_filtered, gender, predicted_time) %>% mutate(category = "Gender")
best_race_count_predicted <- calculate_best_times(marathon_data_filtered, races_count, predicted_time) %>% mutate(category = "Races Count")
best_iaaf_category_predicted <- calculate_best_times(marathon_data_filtered, iaaf_category, predicted_time) %>% mutate(category = "IAAF Category")


# Combine predicted results into a single table
predicted_table <- bind_rows(best_age_predicted, best_gender_predicted, best_race_count_predicted, best_iaaf_category_predicted) %>%
  select(
    category,
    best_group, mean_time
  ) %>%
  rename(
    "Category" = category,
    "Predicted Best Group" = best_group,
    "Predicted Mean Time (seconds)" = mean_time
  )

# Format the predicted table for display
predicted_table_display <- kable(predicted_table, align = c("l", "l", "c")) %>%
  kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover", "condensed"))

predicted_table_display # Display Predicted Times Table
```

# Discussion {#sec-discussion}

## Predicting Marathon Finishing Times Using Demographic Data

This study aimed to develop a model for predicting marathon finishing times based on demographic factors such as age and gender. By analyzing the relationship between these variables and actual marathon performance, we can gain valuable insights into the factors influencing marathon results and how well demographic information can predict performance. The model appears to capture key trends, such as the general increase in finishing times with age, as well as differences between genders, with males tending to have faster predicted times than females. These findings are consistent with previous literature suggesting that younger participants and males generally perform better in marathons. Moreover, the model was able to predict marathon finishing times with a high degree of accuracy, as evidenced by the close alignment of actual and predicted times in the scatter plot.

The analysis also provided insight into the variability in predicted times, especially through the inclusion of prediction intervals, which revealed the range of uncertainty surrounding each prediction. This aspect of the analysis helps highlight the potential for error in any model and the need to consider prediction intervals when interpreting the results. In particular, the spread of predicted times by age and gender demonstrates the complexity of predicting marathon times for individuals based on demographic data alone.

## Age and Gender as Significant Predictors

One of the key findings of this study is the role of age and gender in predicting marathon finishing times. The model demonstrated that age is a significant predictor, with older participants generally having slower predicted times. This trend aligns with what is commonly observed in long-distance running, where younger athletes often perform better due to physical factors such as active muscle mass and maximal oxygen consumption [@Connick2015]. The model also revealed a noticeable difference between genders, with males typically predicted to finish faster than females. This trend is consistent with general physiological differences between men and women, as distance running is determined largely by aerobic capacity and muscular strength, both of which men possess to larger degrees than women [@Cheuvront2005].

## Kenyan Runners Dominate in Results

Kenyan runners emerged as the fastest group, aligning with their global reputation in long-distance running. This dominance highlights the interplay of genetic, cultural, and training factors that contribute to exceptional performance. This aligns with previous studies which showed there are several factors that allow Kenyan distance runners to excel. This includes a genetic predisposition, high maximal oxygen intake, high hemoglobin, metabolic efficiency, favorable skeletal-muscle-fiber composition and oxidative enzyme profile, diet, altitude training, and motivation [@kenyanrunners].

## Limitations of the Model:

While the model provided valuable insights into the relationship between demographic factors and marathon performance, there are several limitations to consider. First, the model relies solely on demographic data (age, gender, and country), excluding other potentially influential factors such as training history, diet, and health conditions, which can significantly impact marathon performance. Additionally, the model assumes that demographic factors alone are sufficient to predict marathon times, but in reality, performance is likely influenced by a complex interplay of physical, psychological, and environmental factors that are not captured in the data.

Another limitation is the potential bias in the dataset. If the dataset used for training the model is not representative of the broader marathon population, the model's predictions could be skewed, leading to less accurate results for participants outside the dataset's scope. For example, if the majority of participants in the dataset come from a particular geographic region or socio-economic background, the model may not perform as well for runners from diverse backgrounds. In this case, since the data is solely from the NYC marathon, a significant proportion of the runners are from the NYC metro area and the USA in general.

Finally, the model's ability to predict finishing times may decrease for extreme cases, such as elite runners or those with unusual age profiles (e.g., very young or very old participants).

## Next Steps:

Future research should explore several avenues for improving the model. First, expanding the dataset to include additional variables such as training habits, health conditions, and previous race performance could provide a more comprehensive view of the factors influencing marathon times. Incorporating these variables would likely enhance the model’s accuracy and offer more personalized predictions.

Additionally, current models typically assume linear relationships between predictors and outcomes, but marathon times may be influenced by more complex interactions that could be better captured by more advanced modeling techniques like random forests or gradient boosting.

Another area for future research could involve exploring the impact of environmental factors, such as weather conditions and course difficulty, on marathon performance. These factors could be incorporated into the model to help provide more accurate predictions for races held under different conditions.

# Appendix {#sec-appendix}

## Data Cleaning Notes

The cleaning process began with renaming all columns to standardized and intuitive names, improving readability and ensuring consistency with analysis conventions. Next, data types were adjusted for various variables to align with their intended use. Numerical fields, such as age, overall place, and race count, were converted to integers, while time-based variables like overall time and pace were transformed from string formats (e.g., HH:MM:SS or MM:SS) into total seconds for accurate modeling and analysis. Categorical variables, such as gender and country codes, were encoded as factors to enable statistical comparisons.

Missing values were addressed by assigning meaningful placeholders to critical fields, such as substituting "Unknown" for missing first names, cities, and states, or "N/A" for missing IAAF categories. To facilitate numerical modeling, overall time was split and converted into total seconds, while pace was converted into seconds per mile, allowing for consistent performance comparisons.

Finally, the cleaned dataset was exported in Parquet format using the `arrow` library, chosen for its efficiency in storage and processing. These steps collectively ensured that the dataset was reliable, consistent, and optimized for in-depth analysis.

## Idealized Methodology

### 1. **What is the population, frame, and sample?**

-   **Population**: The population for this study would be all marathon runners globally, including recreational, amateur, and elite athletes who participate in marathons. This includes runners who participate in a wide variety of events, from local races to prestigious international marathons.

-   **Frame**: The frame refers to the specific set of marathon runners who will be considered in the study. Ideally, this would include individuals who have participated in a marathon within the past year, providing up-to-date performance data. The frame could be obtained from event organizers, race registries, or online race databases that track marathon results, such as the *Marathon Handbook* or *World Athletics*.

-   **Sample**: The sample would be a subset of marathon runners from the frame. To make this sample more manageable, it could be stratified by factors such as age, gender, race distance (standard marathon vs. ultra), or region. The sample could include both runners who have already participated in multiple marathons as well as first-time marathoners, ensuring diversity in the data.

### 2. **How is the sample recruited?**

-   **Recruitment through Race Registrations**: Runners who register for marathons could be invited to participate in the study. During the registration process, participants could opt-in to share their marathon data, including times, training habits, and performance metrics, with the study organizers. This can be done through a consent form or a checkbox during the registration process.

-   **Online Platforms and Running Clubs**: Social media platforms, running clubs, or online marathon communities (such as *Reddit’s Running Community*, *Runkeeper*, or *Strava*) could also be used to recruit participants. These platforms allow researchers to directly contact a wide range of runners and invite them to participate.

-   **Incentives**: To increase participation, participants could be incentivized with benefits like personalized marathon performance analysis, discounted race entries, or access to exclusive content (e.g., training guides).

-   **Direct Invitations to Past Participants**: If accessible, invitations could also be sent to runners who have participated in recent marathons, using event data or online race databases.

### 3. **What sampling approach is taken, and what are some of the trade-offs of this?**

**Sampling Approach**: The study could use a **stratified random sampling** approach, where participants are grouped into strata based on factors such as age, gender, marathon experience, and race times. From each group, participants would be randomly selected, ensuring that all key demographics are represented in the final sample. This approach ensures diversity and gives insights into the performance of various runner types (elite vs. recreational, young vs. older, etc.). **Trade-offs**:

-   **Representativeness**: Stratified sampling ensures that the sample reflects the diversity of the marathon population, allowing for more accurate insights across various demographic groups.

-   **Higher Precision**: By ensuring that each subgroup is adequately represented, stratified sampling minimizes the potential bias that could arise from over- or under-representing certain groups.

-   **Complexity**: Stratified sampling can be logistically complex, requiring careful categorization and segmentation of the sample. This can be time-consuming and might involve additional administrative effort to ensure proper stratification.

-   **Cost**: If the sample size is large and the process involves targeted outreach, the cost of recruitment (e.g., incentives, outreach campaigns) could be higher than other simpler approaches, such as convenience sampling.

### 4. **How is non-response handled?**

Non-response occurs when individuals invited to participate in the study choose not to provide their data or drop out of the study. Addressing non-response is important for maintaining the quality and representativeness of the study.

-   **Follow-up Invitations**: If a participant does not respond initially, follow-up emails, phone calls, or social media messages could be sent to encourage them to complete the survey or data collection process. These reminders can highlight the benefits of participation, such as personalized analysis of race performance.

-   **Incentives**: Offering additional incentives (e.g., free access to marathon training programs or race entry discounts) can motivate reluctant participants to engage with the study.

-   **Weighting for Non-Response**: In case of high non-response rates, the study could adjust the results using **statistical weighting**. If certain demographic groups (e.g., older or less experienced runners) are underrepresented due to non-response, their data could be weighted more heavily to correct for this discrepancy.

-   **Post-Study Adjustment**: If certain groups are systematically underrepresented (e.g., female runners, older participants), the data analysis could use **post-hoc adjustments** to account for these disparities and ensure that the final model is as unbiased as possible.

### 5. **What is good and bad about the questionnaire?**

-   **More Context**: Participants could be asked to report on key factors that influence their performance, such as training regimen, injury history, nutrition, sleep quality, and mental state. This contextual data could significantly improve the predictive accuracy of the model by accounting for variables not captured in race results alone.

-   **Flexibility**: The questionnaire could be designed to ask open-ended or scaled questions, allowing for a broad spectrum of data to be collected. This could help uncover insights that are specific to individual runners or subgroups.

-   **Self-Reporting Bias**: One of the major issues with questionnaires is the potential for self-reporting bias. Participants may overestimate their training efforts, underestimate injuries, or report idealized versions of their habits, leading to inaccurate data. This can reduce the reliability of the findings and introduce errors into the predictive model.

-   **Incomplete or Inconsistent Responses**: Participants may skip questions or provide inconsistent responses, making it difficult to create a clean, reliable dataset. Data cleaning processes would be necessary to handle missing or inconsistent data.

-   **Recall Bias**: Runners may struggle to remember specific details about their training or race-day experiences, leading to recall bias. For example, they may not accurately report the total hours of training or the specific times they ran certain distances.

## Idealized Survey

Certainly! Here's an example **survey questionnaire** designed to collect demographic and training data from marathon runners. The structure includes an **introductory section**, followed by **well-constructed questions** ordered logically, and ends with a **thank-you message**. The question types are varied, ensuring the survey is engaging and collects the necessary data for building a more accurate marathon performance model.

### **Marathon Performance and Training Survey**

### **Introduction**

Thank you for participating in this survey! We are collecting data on marathon runners to better understand the factors that contribute to marathon performance. This survey should take approximately 10 minutes to complete. All responses will be kept confidential and used solely for research purposes.

**Contact Information:** If you have any questions about the survey or the data collection process, please contact **Survey Coordinator**: Sophia Brothers

**Email**: sophia.brothers\@mail.utoronto.ca

### **Section 1: Demographic Information**

**1. Age Group:** (Select one)

-   Under 20

-   20-29

-   30-39

-   40-49

-   50-59

-   60 or older

**2. Gender:** (Select one)

-   Male

-   Female

-   Non-binary

-   Prefer not to say

**3. Biological Sex:** (Select one)

-   Male

-   Female

-   Intersex

-   Prefer not to say

**3. What is your highest level of education?** (Select one)

-   High School or equivalent

-   Some College

-   Associate’s Degree

-   Bachelor’s Degree

-   Graduate or Professional Degree

**4. What is your primary occupation?** (Select one)

-   Full-time employed

-   Part-time employed

-   Self-employed

-   Student

-   Retired

-   Other (please specify): \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

### **Section 2: Marathon Experience**

**5. How many marathons have you completed?** (Select one)

-   This is my first marathon

-   1-3 marathons

-   4-6 marathons

-   7 or more marathons

**6. What is your best marathon finish time? (in hours:minutes:seconds)**

-   Open-ended response: \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

**7. How do you usually track your marathon performance?** (Select one)

-   I use a fitness tracker (e.g., Garmin, Fitbit, etc.)

-   I track manually (e.g., running logs, spreadsheets)

-   I use a mobile app (e.g., Strava, Runkeeper, Nike Run Club)

-   I rely on race timing chips only

-   Other (please specify): \_\_\_\_\_\_\_\_\_\_\_\_\_\_

### **Section 3: Training Habits**

**8. On average, how many hours per week do you spend training for a marathon?** (Select one)

-   0-5 hours

-   6-10 hours

-   11-15 hours

-   16+ hours

**9. What types of training do you incorporate into your marathon preparation?** (Select all that apply)

-   Long runs (over 15 miles)

-   Tempo runs (moderate pace for endurance)

-   Interval training (speed work)

-   Cross-training (e.g., cycling, swimming)

-   Strength training (e.g., weightlifting)

-   Yoga or flexibility training

-   Rest days

-   Other (please specify): \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

**10. What is your primary goal for marathon training?** (Select one)

-   Improve race time (speed)

-   Complete the marathon (finish without injury)

-   Train for an ultra marathon or longer distances

-   Participate for fun/charity

-   Other (please specify): \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

**11. Have you ever experienced any of the following training-related injuries?**

-   Runner’s knee

-   IT band syndrome

-   Shin splints

-   Achilles tendonitis

-   Stress fractures

-   Ankle sprains

-   None

-   Other (please specify): \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

### **Section 4: Race-Day Factors**

**12. What time of day do you typically prefer to run marathons?** (Select one)

-   Morning (before 10 AM)

-   Midday (10 AM - 3 PM)

-   Afternoon (3 PM - 6 PM)

-   Evening (after 6 PM)

**13. Do you follow a specific nutrition plan during your marathon training or on race day** (Select one)

-   Yes, I follow a strict nutrition plan

-   I have a general plan but am flexible

-   No, I don’t follow a specific nutrition plan

-   I follow a hydration-only plan

### **Final Section**

Thank you for completing this survey! Your responses will help improve training recommendations for runners.

## Additional Tables & Figures

```{r}
#| label: tbl-keysummaryfull
#| tbl-cap: Summary of the marathon finishing time model, which includes key variables such as age, gender, pace, race count, and age-graded performance. The table presents the model coefficients along with their standard errors.
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Load the model
finisher_model <- readRDS(here::here("models/finisher_model.rds"))

# Display the model summary as a table with kableExtra
modelsummary(finisher_model,
  output = "kableExtra",
  statistic = "std.error",
  longtable = TRUE
) %>%
  kable_styling(latex_options = c("striped", "scale_down"))
```

\newpage

# References
